<!--
Filename: login.html
Author: Christian Heckendorf
Created date: 09/30/2013
Purpose: Example login and token renewal interface
Feature: None
-->
<html>
<head>
	<title>Hello!</title>
	<meta charset="utf-8">
	<script src="jquery-1.10.2.min.js"></script>
	<script>
		var tok;

		/************************************************************
		Function name: renewToken
		Author: Christian Heckendorf
		Created date: 09/30/2013
		Purpose: Renews a token
		************************************************************/
		function renewToken(){
			$.ajax({
				type: 'POST',
				url: '/plm/rest/renewtoken',
				contentType: 'application/json; charset=UTF-8',
				accepts: {
					text: 'application/json'
				},
				dataType: 'json',
				data: JSON.stringify({
					token: tok
				}),
				success: function(data){
					// You should also check data.code
					//// 0 = success, >0 = some error
					$("h1#second").html(data.message);
				},
				error: function(data){
					alert("error");
				}
			});
		}

		/************************************************************
		Function name: loginUser
		Author: Christian Heckendorf
		Created date: 09/30/2013
		Purpose: Logs in a user
		************************************************************/
		function loginUser(){
			$.ajax({
				type: 'POST',
				url: '/plm/rest/login',
				contentType: 'application/json; charset=UTF-8',
				accepts: {
					text: 'application/json'
				},
				dataType: 'json',
				data: JSON.stringify({
					name: 'someName',
					password: 'somePassword'
				}),
				success: function(data){
					// You should also check data.code
					//// 0 = success, >0 = some error
					$("h1#first").html(data.message);

					// Note: You might want to encrypt this and store as a cookie
					tok = data.message;

					// As an example we'll renew the token in 3 seconds
					//// It currently expires in an hour; maybe refresh in 30 min and on page load?
					setTimeout(function(){renewToken();},3000);
				},
				error: function(data){
					alert("error");
				}
			});
		}
	</script>
</head>
<body onload="loginUser()">
	Token:
	<h1 id="first"></h1>
	Refreshed token:
	<h1 id="second"></h1>
</body>
</html>
